---
  - name: Set inventory content
    copy:
      dest: "{{ lookup('env', 'INVENTORY_DIR') }}/tmp.vmware.yml"
      content: |
        {{ content }}
        hostname: '{{ vcenter_hostname }}'
        username: '{{ vcenter_username }}'
        password: '{{ vcenter_password }}'
        port: '{{ vcenter_port|default('443') }}'
        validate_certs: {{ vmware_validate_certs|default('no') }}
    changed_when: false
    check_mode: false

  - name: Debug tmp.vmware.yml
    debug:
       msg: "{{ lookup('file', '/home/zuul/.ansible/collections/ansible_collections/community/vmware/tests/integration/targets/inventory_vmware_host_inventory/_test/hosts/tmp.vmware.yml') }}"

  - meta: refresh_inventory

  - debug:
      msg: "{{ hostvars }}"

  - name: Refresh test_host
    set_fact:
      test_host: "{{ hostvars | dict2items | first }}"
    when: hostvars | length >= 1
